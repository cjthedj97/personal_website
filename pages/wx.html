---
permalink: /wx
layout: none
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weather Forecast</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå°Ô∏è</text></svg>">

<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0; 
    background: linear-gradient(135deg, #2b2f38, #1c1f26);
    color: #e3e9f0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.5;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
  }

  header {
    text-align: center;
    margin-bottom: 1rem;
  }

  header h1 {
    font-weight: 700;
    font-size: 2rem;
    margin: 0;
    color: #ffd166;
    text-shadow: 0 0 5px #ffd166aa;
  }

  main {
    width: 100%;
    max-width: 900px;
  }

  /* Loading & error message styles */
  #weather-data.loading,
  #weather-data.error {
    background: #3a3f4b;
    padding: 2rem;
    border-radius: 8px;
    font-size: 1.2rem;
    color: #ff6b6b;
    text-align: center;
    user-select: none;
    box-shadow: 0 0 10px #ff6b6b33;
  }

  #weather-data.loading {
    color: #ffd166;
    box-shadow: 0 0 10px #ffd16633;
  }

  /* Alerts section */
  .active-alerts {
    margin-bottom: 1.5rem;
  }

  .active-alerts h2 {
    margin-top: 0;
    margin-bottom: 1rem;
  }

  .active-alerts ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .active-alerts li {
    margin-bottom:1em;
    padding:0.75em 1em;
    background:#3a1e1e;
    border-radius:6px;
    box-shadow: 0 0 8px #ff6b6b88;
    color: #ffeaea;
  }

  .active-alerts li p {
    margin: 0.4em 0 0 0;
  }

  /* Current conditions card */
  .current-conditions-wrapper {
    background: #242833;
    padding: 1.5rem 2rem;
    border-radius: 10px;
    box-shadow: 0 0 12px #2a9d8faa;
    margin-bottom: 2rem;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    grid-gap: 1.5rem;
    align-items: center;
    color: #caf0f8;
  }

  .current-conditions-wrapper h2 {
    grid-column: 1 / -1;
    margin: 0 0 1rem 0;
    font-weight: 700;
    font-size: 1.8rem;
    color: #ffd166;
  }

  .detailed-forecast {
    font-size: 1rem;
    line-height: 1.4;
  }

  .current-conditions-icon {
    width: 96px;
    height: 96px;
    object-fit: contain;
    filter: drop-shadow(0 0 3px #ffd166aa);
  }

  .current-stats {
    color: #caf0f8;
    font-size: 1rem;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .current-stats strong {
    color: #ffd166;
  }

  .radar-container {
    display: flex;
    justify-content: center;
  }

  .radar-image {
    width: 280px;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 0 10px #2a9d8f33;
    border: 1px solid #2a9d8f44;
  }

  /* Upcoming forecast */
  .upcoming-forecast {
    background: #2a303c;
    border-radius: 10px;
    padding: 1rem 2rem;
    box-shadow: 0 0 10px #264653aa;
  }

  .upcoming-forecast h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    color: #e9c46a;
    font-weight: 700;
    font-size: 1.5rem;
    text-align: center;
  }

  .forecast-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .forecast-card {
    background: #1f2431;
    border-radius: 10px;
    padding: 1rem 1.25rem;
    box-shadow: 0 0 8px #1f2431aa;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    color: #ade8f4;
  }

  .forecast-card img {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    object-fit: contain;
    filter: drop-shadow(0 0 2px #e9c46aaa);
  }

  .forecast-info h3 {
    margin: 0 0 0.4rem;
    font-size: 1.1rem;
    font-weight: 700;
    color: #f4a261;
  }

  .forecast-info p {
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.3;
  }

  /* Responsive */
  @media (max-width: 650px) {
    .current-conditions-wrapper {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .current-conditions-icon {
      margin: 0 auto 1rem auto;
    }

    .current-stats {
      flex-direction: row;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      font-size: 0.9rem;
    }

    .radar-image {
      width: 100%;
      max-width: 280px;
      margin: 1rem auto 0;
    }
  }
</style>
</head>
<body>
<header>
  <h1 id="page-title">Weather Forecast</h1>
</header>

<main>
  <section id="weather-data" class="loading" aria-live="polite" aria-busy="true">
    Loading weather data...
  </section>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const weatherDataDiv = document.getElementById('weather-data');
  const pageTitle = document.getElementById('page-title');
  
  function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      lat: params.get('lat'),
      lon: params.get('lon')
    };
  }
  
  async function fetchActiveAlertsForZone(zoneId) {
    try {
      const alertsUrl = `https://api.weather.gov/alerts/active/zone/${zoneId}`;
      const response = await fetch(alertsUrl);
      if (!response.ok) {
        console.warn('Failed to fetch alerts for zone', zoneId);
        return [];
      }
      const data = await response.json();
      if (!data.features || data.features.length === 0) return [];
      return data.features.map(f => f.properties);
    } catch (err) {
      console.error('Error fetching alerts:', err);
      return [];
    }
  }

  async function fetchWeatherData(lat, lon) {
    weatherDataDiv.className = 'loading';
    weatherDataDiv.textContent = 'Loading weather data...';

    try {
      const pointRes = await fetch(`https://api.weather.gov/points/${lat},${lon}`);
      if (!pointRes.ok) throw new Error('Failed to fetch weather data');

      const pointData = await pointRes.json();
      const forecastUrl = pointData.properties.forecast;
      const radarStation = pointData.properties.radarStation;
      const city = pointData.properties.relativeLocation.properties.city;

      document.title = `${city} Weather Forecast`;
      pageTitle.textContent = `${city} Weather Forecast`;

      // Extract zoneId from forecastZone link for alerts
      let zoneId = null;
      if(pointData.properties.forecastZone) {
        const parts = pointData.properties.forecastZone.split('/');
        zoneId = parts[parts.length - 1];
      }

      // Fetch alerts
      let alerts = [];
      if(zoneId) {
        alerts = await fetchActiveAlertsForZone(zoneId);
      }

      // Fetch forecast data
      const forecastRes = await fetch(forecastUrl);
      if (!forecastRes.ok) throw new Error('Failed to fetch forecast data');
      const forecastData = await forecastRes.json();

      displayWeatherData(forecastData, radarStation, alerts);
    } catch (error) {
      weatherDataDiv.className = 'error';
      weatherDataDiv.textContent = `An error occurred: ${error.message}`;
    }
  }
  
  function displayWeatherData(data, radarStation, alerts=[]) {
    weatherDataDiv.className = '';
    const periods = data.properties.periods;
    const currentPeriod = periods[0];
    const radarImageUrl = `https://radar.weather.gov/ridge/standard/${radarStation}_loop.gif`;

    // Alerts HTML block
    let alertsHtml = '';
    if (alerts.length > 0) {
      alertsHtml = `
        <section class="active-alerts" aria-live="polite" aria-label="Active Alerts">
          <h2 style="color:#ff6b6b;">Active Weather Alerts</h2>
          <ul>
            ${alerts.map(alert => `
              <li>
                <strong>${alert.headline || alert.event}</strong><br />
                <em>Severity:</em> ${alert.severity}, <em>Urgency:</em> ${alert.urgency}<br />
                <em>Effective:</em> ${new Date(alert.effective).toLocaleString()}<br />
                <em>Expires:</em> ${new Date(alert.expires).toLocaleString()}<br />
                <p>${alert.description || ''}</p>
                ${alert.instruction ? `<p><strong>Instruction:</strong> ${alert.instruction}</p>` : ''}
              </li>
            `).join('')}
          </ul>
        </section>`;
    } else {
      alertsHtml = `
        <section class="active-alerts" aria-live="polite" aria-label="Active Alerts">
          <h2 style="color:#4caf50;">No Active Weather Alerts</h2>
        </section>`;
    }

    let html = `
      ${alertsHtml}

      <div class="current-conditions-wrapper" role="region" aria-labelledby="current-conditions-title">
        <h2 id="current-conditions-title">${currentPeriod.name}</h2>
        <p class="detailed-forecast" aria-label="Detailed forecast">${currentPeriod.detailedForecast}</p>

        <img 
          class="current-conditions-icon" 
          src="${currentPeriod.icon.startsWith('http') ? currentPeriod.icon : 'https://api.weather.gov/' + currentPeriod.icon}" 
          alt="${currentPeriod.shortForecast}" 
          width="96" height="96"
        />

        <div class="current-stats" aria-label="Current weather stats">
          <p><strong>Temperature:</strong> ${currentPeriod.temperature} ${currentPeriod.temperatureUnit}</p>
          <p><strong>Temperature Trend:</strong> ${currentPeriod.temperatureTrend || 'N/A'}</p>
          <p><strong>Probability of Precipitation:</strong> ${currentPeriod.probabilityOfPrecipitation.value != null ? currentPeriod.probabilityOfPrecipitation.value + '%' : 'N/A'}</p>
          <p><strong>Wind Speed:</strong> ${currentPeriod.windSpeed}</p>
        </div>

        <div class="radar-container" aria-label="Radar image">
          <img class="radar-image" src="${radarImageUrl}" alt="Current radar image" />
        </div>
      </div>
    `;

    // Upcoming forecast cards
    html += '<section class="upcoming-forecast" aria-labelledby="upcoming-forecast-title"><h2 id="upcoming-forecast-title">Upcoming Weather Forecast</h2><div class="forecast-list">';
    periods.slice(1).forEach(period => {
      const iconUrl = period.icon.startsWith('http') ? period.icon : 'https://api.weather.gov/' + period.icon;
      html += `
        <article class="forecast-card" aria-label="${period.name} forecast">
          <img src="${iconUrl}" alt="${period.shortForecast}" width="48" height="48" />
          <div class="forecast-info">
            <h3>${period.name}</h3>
            <p>${period.detailedForecast}</p>
          </div>
        </article>
      `;
    });
    html += '</div></section>';


    weatherDataDiv.innerHTML = html;
  }

  const { lat, lon } = getQueryParams();
  if (lat && lon) {
    fetchWeatherData(lat, lon);
  } else {
    weatherDataDiv.className = 'error';
    weatherDataDiv.innerHTML = `
      <p><strong>Invalid Coordinates:</strong> Coordinates need to be passed in the URL query parameters.</p>
      <p>For example, Chicago, IL is Latitude 41.88 Longitude -87.63</p>
      <p>
        <a href="${window.location.pathname}?lat=41.88&lon=-87.63" style="color:#ffd166; text-decoration: underline;">
          ${window.location.pathname}?lat=41.88&lon=-87.63
        </a>
      </p>`;
  }
});
</script>
</body>
</html>